process ConvertedPhoton = 
{



 source = PoolSource 
  {
    # Number of events program should run
    #untracked vstring fileNames = {'file:ZSphoton50GeVRecHits100ev.root'}
    untracked vstring fileNames = {'file:/tmp/nancy/ele50GeVRecHits10ev_080.root'}	

    untracked int32 maxEvents = 10
  }



 # initialize magnetic field
 # include "MagneticField/Engine/data/volumeBasedMagneticField.cfi"
 
include "Geometry/CMSCommonData/data/cmsMagneticFieldXML.cfi"



es_module = VolumeBasedMagneticFieldESProducer
{
                   double findVolumeTolerance = 0.0
                   untracked bool cacheLastVolume = true
                   untracked bool timerOn = false
}

  # for the geometry:
  # full detector geometry
  include "Geometry/CMSCommonData/data/cmsSimIdealGeometryXML.cfi"

 #--------------------------------
  # Ecalgeometry for clustering
  #--------------------------------
  es_module = EcalBarrelGeometryEP {}
  es_module = EcalEndcapGeometryEP {}
  es_module = HcalHardcodeGeometryEP {}
  es_module = CaloTowerHardcodeGeometryEP {}
  es_module = CaloGeometryBuilder {}



############### Tracker geometry #####################
include "Geometry/TrackerGeometryBuilder/data/trackerGeometry.cfi"
include "Geometry/TrackerNumberingBuilder/data/trackerNumberingGeometry.cfi"
include "RecoTracker/GeometryESProducer/data/TrackerRecoGeometryESProducer.cfi"

 ### Pixel Clusterizer and RecHit producer modules
  include "RecoLocalTracker/SiPixelClusterizer/data/SiPixelClusterizer.cfi"
  include "RecoLocalTracker/SiPixelRecHits/data/SiPixelRecHits.cfi"

  ### SiliconStrip Clusterizer and RecHit producer modules
  include "RecoLocalTracker/SiStripClusterizer/data/SiStripClusterizer_SimData.cfi"
  include "RecoLocalTracker/SiStripRecHitConverter/data/SiStripRecHitConverter.cfi" 
include "RecoLocalTracker/SiStripRecHitConverter/data/StripCPEfromTrackAngle.cfi"  
include "RecoTracker/TransientTrackingRecHit/data/TransientTrackingRecHitBuilder.cfi"
include "RecoLocalTracker/SiPixelRecHits/data/PixelCPEParmError.cfi"


include "RecoEcal/EgammaClusterProducers/data/islandClusteringSequence.cff"


  # supercluster producer
#  module superclusterproducer = SuperClusterProducer
 # {
 #   string superclusterCollection = "superclusterCollection"
 # }



# additional stuff for the tracker

es_module = KFUpdatorESProducer
{
  string ComponentName = "KFUpdator"
}

# Chi2MeasurementEstimatorESProducer
include "TrackingTools/KalmanUpdators/data/Chi2MeasurementEstimatorESProducer.cfi"

# KFTrajectoryFitterESProducer
include "TrackingTools/TrackFitters/data/KFTrajectoryFitterESProducer.cfi"

# KFTrajectorySmootherESProducer
include "TrackingTools/TrackFitters/data/KFTrajectorySmootherESProducer.cfi"

# KFFittingSmootherESProducer
include "TrackingTools/TrackFitters/data/KFFittingSmootherESProducer.cfi"



es_module MaterialPropagator = PropagatorWithMaterialESProducer {
  string ComponentName = "PropagatorWithMaterial"
  string PropagationDirection = "alongMomentum"
  double Mass = 0.105
}

es_module OppositeMaterialPropagator = PropagatorWithMaterialESProducer {
  string ComponentName = "PropagatorWithMaterialOpposite"
  string PropagationDirection = "oppositeToMomentum"
  double Mass = 0.105
}


  # Converted Photon Producer
  module convPhoProducer = ConvertedPhotonProducer
  {

    double NSigmaInside =3

    string bcProducer  =   "islandBasicClusterProducer"
    string  bcCollection = "islandBarrelBasicClusterCollection"
	
    string scProducer   =     "islandSuperClusterProducer"
    string scCollection =     "islandBarrelSuperClusterCollection"
    string convertedPhotonCollection = "ConvertedPhotonCollection"

        string SeedProducer         = "GlobalPixelSeeds"
	double ptCut                = 0.3
	int32  maxCand              = 5
        int32  maxLostHit           = 1	
	int32  maxConsecLostHit     = 1
	double lostHitPenalty       = 30.
	bool   intermediateCleaning = true
        int32  minimumNumberOfHits  = 3
	bool   alwaysUseInvalidHits = true
        bool   seedCleaning         = false
	string TTRHBuilder          =  "WithTrackAngle"

        bool   outInSeedCleaning  = true
        bool   inOutSeedCleaning  = true 
        double  smootherChiSquareCut = 100.
  }






 sequence trackerRecHit = { pixClust,pixRecHitConverter, ThreeThresholdClusterizer,LocalMeasurementConverter}
 sequence convPho = { convPhoProducer}	 

 path p1 = {islandClusteringSequence , trackerRecHit, convPho }
 


  module o1 = PoolOutputModule 
   { 
      untracked string fileName = "/tmp/nancy/ele50GeVConvPhoton100.root" 

      untracked vstring outputCommands = 
      {
        "keep *"
      }
   }
   endpath outpath = { o1 }





}


